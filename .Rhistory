}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
plot1<-ggplot(df) +
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
#save image, modify based on need
ggsave("plot-Entropy-and-incidence-of-totalvariants.jpg",dpi=600,height= 7.5,width = 15,unit="in",device = 'jpg')
#load data from csv file
data<-read.csv("C:\\desktop\\Research_BVU\\diversityProject\\B19V_trial5_dimav4.1.1\\step5_Rplot\\B19V_dima-v4.1.1.csv")
df <- data.frame(data)
#NOTE: user is required to set the protein order here
#leave the protein order as default; follow the order in csv file
proteinOrder=""
#NOTE: user is required to input the number of host here
host <-1
#determine number of host
#scale the amino acid position for each protein
if (host ==1){ #single host
if (proteinOrder ==""){
a<-table(df$proteinName)
proteinName<-as.vector(names(a))
position<-as.vector(a)
df$size_f = factor(df$proteinName,levels = proteinName)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, proteinName,position)
}else{
#order the proteins based on user input
level<-strsplit(proteinOrder, ',')[[1]]
position<-c()
for (i in level){
position<-append(position,table(df$proteinName)[names(table(df$proteinName)) == i])
}
df$size_f = factor(df$proteinName,levels = level)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, level,position)
}
}else{ # multihost
#categorise data based on host
df$Host<- factor(df$Host)
#count the aa length for each proteins (each host is expected to have same number of proteins with same length)
df_sub<-df[df$Host==unique(df$Host[1]),]
if (proteinOrder ==""){
a<-table(df_sub$proteinName)
proteinName<-as.vector(names(a))
position<-as.vector(a)
df$size_f = factor(df$proteinName,levels = proteinName)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, proteinName,position)
}else{
#order the proteins based on user input
level<-strsplit(proteinOrder, ',')[[1]]
position<-c()
for (i in level){
position<-append(position,table(df_sub$proteinName)[names(table(df_sub$proteinName)) == i])
}
df$size_f = factor(df$proteinName,levels = level)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, level,position)
}
}
if (proteinOrder ==""){
a<-table(df$proteinName)
proteinName<-as.vector(names(a))
position<-as.vector(a)
df$size_f = factor(df$proteinName,levels = proteinName)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, proteinName,position)
}else{
#order the proteins based on user input
level<-strsplit(proteinOrder, ',')[[1]]
position<-c()
for (i in level){
position<-append(position,table(df$proteinName)[names(table(df$proteinName)) == i])
}
df$size_f = factor(df$proteinName,levels = level)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, level,position)
}
#load data from csv file
data<-read.csv("C:\\desktop\\Research_BVU\\diversityProject\\B19V_trial5_dimav4.1.1\\step5_Rplot\\B19V_dima-v4.1.1.csv")
df <- data.frame(data)
#Entropy and incidence of total variants
library(ggplot2)
library(gridExtra) #tutorial: https://ggplot2.tidyverse.org/reference/facet_grid.html
library(facetscales) #https://stackoverflow.com/a/54074323/13970350
library(dplyr)
#NOTE: user is required to set the protein order here
#leave the protein order as default; follow the order in csv file
proteinOrder=""
#NOTE: user is required to input the number of host here
host <-1
#determine number of host
#scale the amino acid position for each protein
if (host ==1){ #single host
if (proteinOrder ==""){
a<-table(df$proteinName)
proteinName<-as.vector(names(a))
position<-as.vector(a)
df$size_f = factor(df$proteinName,levels = proteinName)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, proteinName,position)
}else{
#order the proteins based on user input
level<-strsplit(proteinOrder, ',')[[1]]
position<-c()
for (i in level){
position<-append(position,table(df$proteinName)[names(table(df$proteinName)) == i])
}
df$size_f = factor(df$proteinName,levels = level)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, level,position)
}
}else{ # multihost
#categorise data based on host
df$Host<- factor(df$Host)
#count the aa length for each proteins (each host is expected to have same number of proteins with same length)
df_sub<-df[df$Host==unique(df$Host[1]),]
if (proteinOrder ==""){
a<-table(df_sub$proteinName)
proteinName<-as.vector(names(a))
position<-as.vector(a)
df$size_f = factor(df$proteinName,levels = proteinName)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, proteinName,position)
}else{
#order the proteins based on user input
level<-strsplit(proteinOrder, ',')[[1]]
position<-c()
for (i in level){
position<-append(position,table(df_sub$proteinName)[names(table(df_sub$proteinName)) == i])
}
df$size_f = factor(df$proteinName,levels = level)
scales_x<-mapply(function(x,y){
x = scale_x_continuous(limits = c(0,y),breaks = seq(0,y,50))
}, level,position)
}
}
#----------------plotting--------------------#
#detect if low support present
if (TRUE %in% df$lowSupport){
df$lowSupportPos <- -0.3
df$lowSupportPos[df$lowSupport ==TRUE]<- -0.5
plot1<-ggplot(df) +
geom_rect(inherit.aes = FALSE,
aes(xmin=position, xmax=end, ymin=-Inf, ymax=+Inf),
fill='#FFECAF', alpha=ifelse(df$end == -1, 0, 0.5))+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"), show.legend=F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_point(mapping = aes(x = position,y=lowSupportPos),col=ifelse(df$lowSupportPos==-0.5, 'black', ifelse(df$lowSupportPos==-0.3, 'white', 'white')), alpha=ifelse(df$lowSupportPos==-0.5, 1, ifelse(df$lowSupportPos==-0.3, 0,0)),pch=17)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98* maxy / 100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "k-mer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,25,50,75,100),labels=c("0","25","50","75","100")),
breaks = seq(0.0, maxy, length.out = 5),labels= sprintf(seq(0.0, maxy, length.out = 5), fmt = "%.1f")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
}else{
plot1<-ggplot(df) +
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
}
plot1
View(data)
plot1<-ggplot(df) +
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
plot1<-ggplot(df) +
geom_line(mapping = aes(x = position, y = 0.1, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
plot1<-ggplot(df) +
geom_line(mapping = aes(x = position, y = 0.1, color = "blue",linetype="Total Variants"), size= 0.3 )+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
plot1<-ggplot(df) +
geom_line(mapping = aes(x = position, y = 0.1, color = "blue",linetype="Total Variants"), size= 0.5 )+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
plot1<-ggplot(df) +
geom_line(mapping = aes(x = position, y = 0.1, color = "blue",linetype="Total Variants"), size= 1 )+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
getwd()
#save image, modify based on need
ggsave("plot1_y0.1.jpg",dpi=600,height= 7.5,width = 15,unit="in",device = 'jpg')
plot1<-ggplot(df) +
geom_line(mapping = aes(x = position, y = 0.05, color = "blue",linetype="Total Variants"), size= 1 )+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
#save image, modify based on need
ggsave("plot1_y0.05.jpg",dpi=600,height= 7.5,width = 15,unit="in",device = 'jpg')
plot1<-ggplot(df) +
geom_line(mapping = aes(x = position, y = 0.5, color = "blue",linetype="Total Variants"), size= 1 )+
geom_area(mapping = aes(x = position, y = entropy,color= "k-mer Entropy", linetype="k-mer Entropy"),show.legend = F)+
geom_hline(mapping = aes(yintercept=9.2, color = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)", linetype = "Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
geom_line(mapping = aes(x = position, y = totalVariants.incidence * maxy / 100, color = "Total Variants",linetype="Total Variants"), size= 0.3 )+
geom_hline(mapping = aes( yintercept=98 * maxy /100, color = "Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)",linetype ="Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"), size= 0.2)+
labs(y = "Nonamer entropy (bits)\n",x= "\nk-mer position (aa)",color = "#f7238a")+
#how to second y-axis: https://whatalnk.github.io/r-tips/ggplot2-rbind.nb.html
scale_y_continuous(sec.axis = sec_axis(~ . * 100 / maxy , name = "Total variants (%)",breaks = c(0,10,20,30,40,50,60,70,80,90,100),labels=c("0","10","20","30","40","50","60","70","80","90","100")),
breaks = c(0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0),labels=c("0.0","1.0","2.0","3.0","4.0","5.0","6.0","7.0","8.0","9.0","10.0")) +
theme_classic() +
theme(
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line.y.right = element_line(color = "#f7238a"),
axis.ticks.y.right = element_line(color = "#f7238a"),
axis.title.y.right =  element_text(color = "#f7238a"),
legend.position="bottom"
)+
scale_colour_manual("",
values = c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"="#f7238a",
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"="black",
"k-mer Entropy" = "black",
"Total Variants"="#f7238a"),
guide = guide_legend(override.aes=aes(fill=NA)))+
scale_linetype_manual("",values=c("Reference: Maximum Total Variants (98%) for HIV-1 Clade B (Env Protein)"=5,
"Reference: Maximum Entropy (9.2) for HIV-1 Clade B (Env Protein)"=5,
"k-mer Entropy" = 1,
"Total Variants"=1))
#number of host
if (host == 1){ #one host
plot1 +facet_grid_sc(col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "x")
}else{ # multi host
plot1 +facet_grid_sc(rows = vars(df$host),col=vars(df$size_f),scales = list(x = scales_x),space = "free",switch = "both")
}
#save image, modify based on need
ggsave("plot1_y0.5.jpg",dpi=600,height= 7.5,width = 15,unit="in",device = 'jpg')
shiny::runApp('C:/projects/DiveR_public/DiveR')
runApp('C:/projects/DiveR_public/DiveR')
